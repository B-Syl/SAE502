---
- name: "Installer PHP"
  shell: |
    export DEBIAN_FRONTEND=noninteractive
    apt install -y php

- name: "Installer LAMP"
  apt:
    name: "apache2, mysql-server, php, libapache2-mod-php, php-mysql"
    state: "present"

- name: "Recup config index apache2"
  copy:
    src: /root/dir.conf
    dest: /etc/apache2/mods-enabled/dir.conf
    remote_src: yes

- name: "Recup config site apache2"
  copy:
    src: /root/site_db.conf
    dest: /etc/apache2/sites-available/site_db.conf
    remote_src: yes

- name: "Stat documentroot site_db"
  stat:
    path: /var/www/site_db
  register: site_db

- name: "Creation repertoire"
  command:
    mkdir /var/www/site_db
  when: not site_db.stat.exists

- name: "Recup Page PHP apache2"
  copy:
    src: /root/index.php
    dest: /var/www/site_db/index.php
    remote_src: yes

- name: "Activer service apache"
  command:
    service apache2 start

- name: "Activer site apache2"
  shell: |
    a2dissite 000-default
    a2ensite site_db
    service apache2 reload

- name: "Activer service mysql"
  command:
    service mysql start
